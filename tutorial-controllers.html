<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8" />
    <title>controllers - jimpex docs</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <link rel="shortcut icon" href="icons/favicon-48.png" />
    <link rel="apple-touch-icon" sizes="48x48" href="icons/favicon-48.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="icons/favicon-72.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="icons/favicon-96.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="icons/favicon-144.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icons/favicon-192.png" />
    <link rel="apple-touch-icon" sizes="256x256" href="icons/favicon-256.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="icons/favicon-384.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="icons/favicon-512.png" />
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html" class="home-link">jimpex</a></h2><ul class="ref-links">
            <li><a
                class="ref-link -yarn"
                title="View the package on Yarn"
                href="https://yarnpkg.com/package/jimpex"
                target="_blank"
            >View the package on Yarn</a></li>
        

            <li><a
                class="ref-link -github"
                title="Go to the GitHub repository"
                href="https://github.com/homer0/jimpex"
                target="_blank"
            >Go to the GitHub repository</a></li>
        

            <li><a
                class="ref-link -npm"
                title="View the package on NPM"
                href="https://www.npmjs.com/package/jimpex"
                target="_blank"
            >View the package on NPM</a></li>
        </ul><h3>Modules</h3><ul><li><a href="module-constants.html">constants</a></li><li><a href="module-controllers.html">controllers</a></li><li><a href="module-core.html">core</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core.html#~jimpex">jimpex</a></li></ul></li><li><a href="module-functions.html">functions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-functions.html#.createRouteExpression">createRouteExpression</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.escapeForRegExp">escapeForRegExp</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeLeadingSlash">removeLeadingSlash</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeSlashes">removeSlashes</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeTrailingSlash">removeTrailingSlash</a></li></ul></li><li><a href="module-middlewares.html">middlewares</a></li><li><a href="module-services.html">services</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-services.html#.appErrorGenerator">appErrorGenerator</a></li><li data-type='method' style='display: none;'><a href="module-services.html#.httpErrorGenerator">httpErrorGenerator</a></li><li data-type='method' style='display: none;'><a href="module-services.html#.sendFile">sendFile</a></li></ul></li><li><a href="module-wrappers.html">wrappers</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-wrappers.html#.controller">controller</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.controllerCreator">controllerCreator</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.middleware">middleware</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.middlewareCreator">middlewareCreator</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-controllers.html">controllers</a></li><li><a href="tutorial-middlewares.html">middlewares</a></li><li><a href="tutorial-options.html">options</a></li><li><a href="tutorial-services.html">services</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">controllers</h1>
    

    <section>
  <header>
    <h2>controllers</h2>
  </header>
  <article class="tutorial">
    <h1>Built-in Controllers</h1>
<p>All of these controllers are available on the Jimpex package and can be easily required and implemented.</p>
<h2>Configuration</h2>
<p>Allows you to see and switch the current configuration. It can be enabled or disabled by using a setting on the configuration.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>responsesBuilder</code></li>
</ul>
<pre class="prettyprint source lang-js"><code>const {
  Jimpex,
  services: {
    http: { responsesBuilder },
  },
  controllers: {
    common: { configurationController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(responsesBuilder);
    
    // Add the controller.
    this.mount('/config', configurationController);
  }
}
</code></pre>
<p>Now, there are two rules behind this controller:</p>
<ol>
<li>Your configuration must have a setting <code>debug.configurationController</code> with the value of <code>true</code>.</li>
<li>To be able to switch configurations, the default configuration and/or the first configuration loaded must have a setting <code>allowConfigurationSwitch</code> set to <code>true</code>.</li>
</ol>
<p>The reason for those rules is that this controller is development purposes as you wouldn't want to make public the settings of your app.</p>
<p>The controller then will mount two routes:</p>
<ul>
<li><code>GET /</code>: It will show the current configuration.</li>
<li><code>GET /switch/:name</code>: It will, if allowed, switch to an specified configuration.</li>
</ul>
<h2>Health</h2>
<p>Shows the version and name of the configuration, just to check the app is running.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>responsesBuilder</code></li>
</ul>
<pre class="prettyprint source lang-js"><code>const {
  Jimpex,
  services: {
    http: { responsesBuilder },
  },
  controllers: {
    common: { healthController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(responsesBuilder);
    
    // Add the controller.
    this.mount('/health', healthController);
  }
}
</code></pre>
<p>That's all there is, the controller mounts only one route:</p>
<ul>
<li><code>GET /</code>: Shows the information.</li>
</ul>
<h2>Statics</h2>
<p>It allows your app to server specific files from any directory, without having to use the <code>static</code> middleware.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>sendFile</code></li>
</ul>
<pre class="prettyprint source lang-js"><code>const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  controllers: {
    common: { staticsController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);
    
    // Add the controller.
    this.mount('/', staticsController);
  }
}
</code></pre>
<p>The controller comes with a lot of default options:</p>
<pre class="prettyprint source lang-js"><code>{
  // The list of files it will serve.
  files: ['favicon.ico', 'index.html'],
  // The HTTP methods for which it will mount routes.
  methods: {
    // If `all` is `true`, then all the others are ignored.
    all: false,
    get: true,
  },
  // The &quot;master&quot; paths to prepend to all file routes and files.
  paths: {
    // The base route from where the files are going to be served.
    route: '',
    // The base path from where the files are located.
    source: './',
  },
}
</code></pre>
<p>All of those values can be customized by calling the controller as a function:</p>
<pre class="prettyprint source lang-js"><code>const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  controllers: {
    common: { staticsController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);
    
    // Add the controller.
    this.mount('/', staticsController({
      paths: {
        route: 'public',
        source: 'secret-folder',
      }
      files: [
        'my-file-one.html',
        'favicon.icon',
        'index.html',
        'some-other.html',
      ],
    }));
  }
}
</code></pre>
<p>You can also specify custom information to each individual file:</p>
<pre class="prettyprint source lang-js"><code>this.mount('/', staticsController({
  files: [
    'my-file-one.html',
    {
      route: 'favicon.ico',
      source: 'icons/fav/icon.ico',
      headers: {
        'X-Custom-Icon-Header': 'Something!',
      },
    },
    'index.html',
  ],
}));
</code></pre>
<p>Finally, you can also add a custom middleware or middlewares to the routes created by the controller, you just need to send a function that returns the middlewares when called.</p>
<pre class="prettyprint source lang-js"><code>/**
 * In this case, we'll use Jimpex's `ensureBearerToken` to protect the
 * file routes.
 */
const filesProtection = (app) => [app.get('ensureBearerToken')];

this.mount('/', staticsController(
  {
    files: [
      'index.html',
    ],
  },
  [filesProtection]
));
</code></pre>
<p>And that's all, the middleware will be added to the route, just before serving the file.</p>
<h2>Gateway</h2>
<p>It allows you to automatically generate a set of routes that will make gateway requests to an specific API.</p>
<ul>
<li>Module: <code>utils</code></li>
<li>Requires: <code>http</code></li>
</ul>
<pre class="prettyprint source lang-js"><code>const {
  Jimpex,
  services: {
    http: { http },
  },
  controllers: {
    utils: { gateway },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(http);
    
    // Add the controller.
    this.mount('/gateway', gateway);
  }
}
</code></pre>
<p>The controller will automatically look into your app configuration for a key called <code>api</code> with the following format:</p>
<pre class="prettyprint source lang-js"><code>{
  url: 'api-entry-point',
  gateway: {
    endpointOne: 'endpoint/one/path',
  },
}
</code></pre>
<blockquote>
<p>Yes, the format is almost the same as the API Client.</p>
</blockquote>
<p>Based on the example above and that configuration, the controller would mount a route on <code>/gateway/endpoint/one/path</code> that would fire a request to <code>api-entry-point/endpoint/one/path</code>.</p>
<p>The controller has a few options that you can customize:</p>
<pre class="prettyprint source lang-js"><code>{

  // The name that will be used to register the controller as a sevice (yes!),
  // so other services can access the API Client configuration the controller
  // generates from its routes.

  serviceName: 'apiGateway',

  // The name of a registered service that will work as a helper, and that the
  // controller will call in order to modify requests, responses and even handle
  // errors.
  helperServiceName: 'apiGatewayHelper',

  // The name of the configuration setting where the gateway configuration is stored.
  // This is also used to wrap the endpoints on the generated API Client configuration.
  configurationSetting: 'api',

  // This is a helper for when the gateway is used with an API client. The idea is
  // that, by default, the routes are mounted on the controller route, but with
  // this option, you can specify another sub path. For example: The controller
  // is mounted on `/routes`, if you set `root` to `gateway`, all the routes will
  // be on `/routes/gateway`.
  root: '',

  // How the gateway will handle headers from requests and responses.
  headers: {

    // Whether or not to include the header with a request real IP.
    useXForwardedFor: true,

    // Whether or not to copy the custom headers (the ones that start with `x-`).
    copyCustomHeaders: true,

    // A list of headers that will be copied from the incoming request into the
    // fetch request.
    copy: [
      'authorization',
      'content-type',
      'referer',
      'user-agent',
    ],

    // A list of headers that will be removed while copying the headers from a
    // fetch response into the server's response.
    remove: [
      'server',
      'x-powered-by',
    ],
  },
}
</code></pre>
<p>The way you overwrite them is by calling the controller as a function:</p>
<pre class="prettyprint source lang-js"><code>const {
  Jimpex,
  services: {
    http: { http },
  },
  controllers: {
    utils: { gateway },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(http);
    
    // Add the controller.
    this.mount('/gateway', gateway({
      serviceName: 'Batman',
    }));
  }
}
</code></pre>
<p>I strongly recommend you to read the techinical documentation in order to know all the things you
can do with the helper service and the logic behind the naming convetion the controller creator enforces (the <code>serviceName</code> must end with <code>Gateway</code>, among other things).</p>
  </article>
  
</section>


    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> using a forked <a href="https://github.com/homer0/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>