<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8" />
    <title>services/http/apiClient.js - jimpex docs</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <link rel="shortcut icon" href="icons/favicon-48.png" />
    <link rel="apple-touch-icon" sizes="48x48" href="icons/favicon-48.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="icons/favicon-72.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="icons/favicon-96.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="icons/favicon-144.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icons/favicon-192.png" />
    <link rel="apple-touch-icon" sizes="256x256" href="icons/favicon-256.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="icons/favicon-384.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="icons/favicon-512.png" />
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html" class="home-link">jimpex</a></h2><ul class="ref-links">
            <li><a
                class="ref-link -yarn"
                title="View the package on Yarn"
                href="https://yarnpkg.com/package/jimpex"
                target="_blank"
            >View the package on Yarn</a></li>
        

            <li><a
                class="ref-link -github"
                title="Go to the GitHub repository"
                href="https://github.com/homer0/jimpex"
                target="_blank"
            >Go to the GitHub repository</a></li>
        

            <li><a
                class="ref-link -npm"
                title="View the package on NPM"
                href="https://www.npmjs.com/package/jimpex"
                target="_blank"
            >View the package on NPM</a></li>
        </ul><h3>Modules</h3><ul><li><a href="module-constants.html">constants</a></li><li><a href="module-controllers.html">controllers</a></li><li><a href="module-core.html">core</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core.html#~jimpex">jimpex</a></li></ul></li><li><a href="module-functions.html">functions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-functions.html#.createRouteExpression">createRouteExpression</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.escapeForRegExp">escapeForRegExp</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeLeadingSlash">removeLeadingSlash</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeSlashes">removeSlashes</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeTrailingSlash">removeTrailingSlash</a></li></ul></li><li><a href="module-middlewares.html">middlewares</a></li><li><a href="module-services.html">services</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-services.html#.appErrorGenerator">appErrorGenerator</a></li><li data-type='method' style='display: none;'><a href="module-services.html#.httpErrorGenerator">httpErrorGenerator</a></li><li data-type='method' style='display: none;'><a href="module-services.html#.sendFile">sendFile</a></li></ul></li><li><a href="module-wrappers.html">wrappers</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-wrappers.html#.controller">controller</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.controllerCreator">controllerCreator</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.middleware">middleware</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.middlewareCreator">middlewareCreator</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-controllers.html">controllers</a></li><li><a href="tutorial-middlewares.html">middlewares</a></li><li><a href="tutorial-options.html">options</a></li><li><a href="tutorial-services.html">services</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">services/http/apiClient.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const ObjectUtils = require('wootils/shared/objectUtils');
const APIClientBase = require('wootils/shared/apiClient');
const { providerCreator } = require('../../utils/wrappers');

/**
 * @typedef {import('../../types').APIClientBase} APIClientBase
 * @typedef {import('../../types').APIClientEndpoints} APIClientEndpoints
 * @typedef {import('./http').HTTP} HTTP
 * @typedef {import('../common/httpError').HTTPError} HTTPError
 */

/**
 * @typedef {import('../../types').ProviderCreator&lt;O>} ProviderCreator&lt;O>
 * @template O
 */

/**
 * The options to customize how the service gets registered.
 *
 * @typedef {Object} APIClientProviderOptions
 * @property {string}           serviceName           The name of the service that will be
 *                                                    registered into the app. Default
 *                                                    `'apiClient'`.
 * @property {string}           configurationSetting  The name of the configuration
 *                                                    setting that has the API
 *                                                    information. Default `'api'`.
 * @property {typeof APIClient} clientClass           The class the service will
 *                                                    instantiate. It has to extend from
 *                                                    {@link APIClient}, which is the
 *                                                    default value.
 * @parent module:services
 */

/**
 * The configuration for the API the client will make requests to.
 *
 * @typedef {Object} APIClientConfiguration
 * @property {string}             url        The API entry point.
 * @property {APIClientEndpoints} endpoints  A dictionary of named endpoints relative to
 *                                           the API entry point.
 * @parent module:services
 */

/**
 * An API client for the app to use. What makes this service special is that its that it
 * formats the received errors using the `AppError` service class and as fetch function it
 * uses the `http` service, allowing the app to to internally handle all the requests and
 * responses.
 *
 * @augments APIClientBase
 * @parent module:services
 */
class APIClient extends APIClientBase {
  /**
   * @param {APIClientConfiguration} apiConfig  The configuration for the API the client
   *                                            will make requests to.
   * @param {HTTP}                   http       To get the `fetch` function for this
   *                                            service to use on all the requests.
   * @param {ClassHTTPError}         HTTPError  To format the received errors.
   */
  constructor(apiConfig, http, HTTPError) {
    super(apiConfig.url, apiConfig.endpoints || apiConfig.gateway, http.fetch);
    /**
     * The configuration for the API the client will make requests to.
     *
     * @type {APIClientConfiguration}
     * @access protected
     * @ignore
     */
    this._apiConfig = ObjectUtils.copy(apiConfig);
    /**
     * A local reference for the class the app uses to generate HTTP errors.
     *
     * @type {ClassHTTPError}
     * @access protected
     * @ignore
     */
    this._HTTPError = HTTPError;
  }
  /**
   * Formats a response error with the App error class.
   *
   * @param {Object} response  A received response from a request.
   * @param {number} status    The HTTP status of the request.
   * @returns {HTTPError}
   */
  error(response, status) {
    return new this._HTTPError(this.getErrorMessageFromResponse(response), status);
  }
  /**
   * Helper method that tries to get an error message from a given response.
   *
   * @param {Object} response                       A received response from a request.
   * @param {string} [fallback='Unexpected error']  A fallback message in case the method
   *                                                doesn't found one on the response.
   * @returns {string}
   */
  getErrorMessageFromResponse(response, fallback = 'Unexpected error') {
    let message;
    if (response.error) {
      message = response.error;
    } else if (response.data &amp;&amp; response.data &amp;&amp; response.data.message) {
      ({ message } = response.data);
    } else if (response.data &amp;&amp; response.data &amp;&amp; response.data.error) {
      message = response.data.error;
    } else {
      message = fallback;
    }

    return message;
  }
  /**
   * The configuration for the API the client will make requests to.
   *
   * @type {APIClientConfiguration}
   * @todo Remove Object.freeze.
   */
  get apiConfig() {
    return Object.freeze(this._apiConfig);
  }
}
/**
 * An API Client service to make requests to an API using endpoints defined on the app
 * configuration.
 *
 * @type {ProviderCreator&lt;APIClientProviderOptions>}
 * @parent module:services
 */
const apiClient = providerCreator((options = {}) => (app) => {
  const defaultName = 'apiClient';
  const { serviceName = defaultName, clientClass: ClientClass = APIClient } = options;
  let { configurationSetting } = options;
  if (!configurationSetting) {
    configurationSetting = serviceName === defaultName ? 'api' : serviceName;
  }
  app.set(
    serviceName,
    () =>
      new ClientClass(
        app.get('appConfiguration').get(configurationSetting),
        app.get('http'),
        app.get('HTTPError'),
      ),
  );
});

module.exports.APIClient = APIClient;
module.exports.apiClient = apiClient;
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> using a forked <a href="https://github.com/homer0/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
