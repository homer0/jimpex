<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/app/index.js | jimpex</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Express as dependency injection container."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="jimpex"><meta property="twitter:description" content="Express as dependency injection container."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/homer0/jimpex"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/class/wootils/shared/apiClient.js~APIClient.html">APIClientBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/typedef/index.html#static-typedef-APIClientEndpoints">APIClientEndpoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/class/wootils/node/appConfiguration.js~AppConfiguration.html">AppConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/class/wootils/node/environmentUtils.js~EnvironmentUtils.html">EnvironmentUtils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/class/wootils/node/errorHandler.js~ErrorHandler.html">ErrorHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://expressjs.com/en/4x/api.html">Express</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="http://expressjs.com/en/guide/using-middleware.html">ExpressMiddleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://expressjs.com/en/4x/api.html#req">ExpressRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://expressjs.com/en/4x/api.html#res">ExpressResponse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://expressjs.com/en/4x/api.html#router">ExpressRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/class/wootils/node/logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/class/wootils/node/pathUtils.js~PathUtils.html">PathUtils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://homer0.github.io/wootils/function/index.html#static-function-rootRequire">RootRequire</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#app">app</a><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/app/index.js~Jimpex.html">Jimpex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-JimpexConfigurationOptions">JimpexConfigurationOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-JimpexDefaultServicesOptions">JimpexDefaultServicesOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-JimpexExpressOptions">JimpexExpressOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-JimpexOptions">JimpexOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-JimpexStaticsOptions">JimpexStaticsOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://yarnpkg.com/en/package/jimple">Jimple</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#constants">constants</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-eventNames">eventNames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-JimpexEvents">JimpexEvents</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#controllers-common">controllers/common</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controllers/common/configuration.js~ConfigurationController.html">ConfigurationController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controllers/common/health.js~HealthController.html">HealthController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controllers/common/statics.js~StaticsController.html">StaticsController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-configurationController">configurationController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-healthController">healthController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-staticsController">staticsController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StaticsControllerPathsOptions">StaticsControllerPathsOptions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#controllers-utils">controllers/utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controllers/utils/gateway.js~GatewayController.html">GatewayController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-gatewayController">gatewayController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayConfiguration">GatewayConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayConfigurationEndpoint">GatewayConfigurationEndpoint</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayConfigurationEndpoints">GatewayConfigurationEndpoints</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayControllerCreatorOptions">GatewayControllerCreatorOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayControllerEndpointInformation">GatewayControllerEndpointInformation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayControllerHeadersOptions">GatewayControllerHeadersOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayControllerOptions">GatewayControllerOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayControllerRequest">GatewayControllerRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayHelperService">GatewayHelperService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayHelperServiceErrorHandler">GatewayHelperServiceErrorHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayHelperServiceRequestReducer">GatewayHelperServiceRequestReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayHelperServiceResponseHandler">GatewayHelperServiceResponseHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayHelperServiceResponseReducer">GatewayHelperServiceResponseReducer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-GatewayHelperServiceStreamVerification">GatewayHelperServiceStreamVerification</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#middlewares-common">middlewares/common</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/middlewares/common/errorHandler.js~ErrorHandler.html">ErrorHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/middlewares/common/forceHTTPS.js~ForceHTTPS.html">ForceHTTPS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-errorHandler">errorHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-forceHTTPS">forceHTTPS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ErrorHandlerDefaultOptions">ErrorHandlerDefaultOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ErrorHandlerOptions">ErrorHandlerOptions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#middlewares-html">middlewares/html</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/middlewares/html/fastHTML.js~FastHTML.html">FastHTML</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/middlewares/html/showHTML.js~ShowHTML.html">ShowHTML</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-fastHTML">fastHTML</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-showHTML">showHTML</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-FastHTMLMiddlewareOptions">FastHTMLMiddlewareOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-FastHTMLOptions">FastHTMLOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ShowHTMLMiddlewareOptions">ShowHTMLMiddlewareOptions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#middlewares-utils">middlewares/utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/middlewares/utils/versionValidator.js~VersionValidator.html">VersionValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-versionValidator">versionValidator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-VersionValidatorOptions">VersionValidatorOptions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services-common">services/common</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/common/appError.js~AppError.html">AppError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/common/httpError.js~HTTPError.html">HTTPError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendFile">sendFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-appError">appError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-httpError">httpError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-commonServices">commonServices</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sendFileProvider">sendFileProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SendFile">SendFile</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services-frontend">services/frontend</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/frontend/frontendFs.js~FrontendFs.html">FrontendFs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-frontendFs">frontendFs</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services-html">services/html</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/html/htmlGenerator.js~HTMLGenerator.html">HTMLGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-htmlGenerator">htmlGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-HTMLGeneratorOptions">HTMLGeneratorOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-HTMLGeneratorProviderOptions">HTMLGeneratorProviderOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-HTMLGeneratorValuesService">HTMLGeneratorValuesService</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services-http">services/http</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/http/apiClient.js~APIClient.html">APIClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/http/http.js~HTTP.html">HTTP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/http/responsesBuilder.js~ResponsesBuilder.html">ResponsesBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-apiClient">apiClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-http">http</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-httpServices">httpServices</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-responsesBuilder">responsesBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-APIClientConfiguration">APIClientConfiguration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-HTTPFetchOptions">HTTPFetchOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ResponsesBuilderPostMessageOptions">ResponsesBuilderPostMessageOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers">Headers</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#services-utils">services/utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/services/utils/ensureBearerToken.js~EnsureBearerToken.html">EnsureBearerToken</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ensureBearerToken">ensureBearerToken</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-utilsServices">utilsServices</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-EnsureBearerTokenErrorOptions">EnsureBearerTokenErrorOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-EnsureBearerTokenOptions">EnsureBearerTokenOptions</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createRouteExpression">createRouteExpression</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-escapeForRegExp">escapeForRegExp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeLeadingSlash">removeLeadingSlash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeSlashes">removeSlashes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-removeTrailingSlash">removeTrailingSlash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-controller">controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-controllerCreator">controllerCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-middleware">middleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-middlewareCreator">middlewareCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-provider">provider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-providerCreator">providerCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-providers">providers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Controller">Controller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ControllerCreator">ControllerCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ControllerCreatorCallback">ControllerCreatorCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ControllerMountCallback">ControllerMountCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Middleware">Middleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MiddlewareCreator">MiddlewareCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MiddlewareCreatorCallback">MiddlewareCreatorCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MiddlewareUseCallback">MiddlewareUseCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-Provider">Provider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ProviderCreator">ProviderCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ProviderCreatorCallback">ProviderCreatorCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ProviderRegistrationCallback">ProviderRegistrationCallback</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/app/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const Jimple = require(&apos;jimple&apos;);
const ObjectUtils = require(&apos;wootils/shared/objectUtils&apos;);
const express = require(&apos;express&apos;);
const bodyParser = require(&apos;body-parser&apos;);
const compression = require(&apos;compression&apos;);
const multer = require(&apos;multer&apos;);

const {
  appConfiguration,
  appLogger,
  environmentUtils,
  packageInfo,
  pathUtils,
  rootRequire,
} = require(&apos;wootils/node/providers&apos;);
const { EventsHub } = require(&apos;wootils/shared&apos;);

const { eventNames } = require(&apos;../constants&apos;);
const commonServices = require(&apos;../services/common&apos;);
const httpServices = require(&apos;../services/http&apos;);
const utilsServices = require(&apos;../services/utils&apos;);
const { escapeForRegExp } = require(&apos;../utils/functions&apos;);
/**
 * Jimpex is a mix of Jimple, a Javascript port of Pimple dependency injection container, and
 * Express, one of the most popular web frameworks for Node.
 * @extends {Jimple}
 * @interface
 * @todo Implement `helmet`
 */
class Jimpex extends Jimple {
  /**
   * Class constructor.
   * @param {Boolean}        [boot=true]  If `true`, after initializing the server, it will
   *                                      immediately call the `boot` method. This can be used on
   *                                      a development environment where you would want to
   *                                      register development services/middlewares/controllers
   *                                      before the app starts.
   * @param {JimpexOptions}  [options={}] Preferences to customize the app.
   * @throws {TypeError} If instantiated directly.
   */
  constructor(boot = true, options = {}) {
    if (new.target === Jimpex) {
      throw new TypeError(
        &apos;Jimpex is an abstract class, it can\&apos;t be instantiated directly&apos;
      );
    }

    super();
    /**
     * The app options.
     * @type {JimpexOptions}
     * @access protected
     * @ignore
     */
    this._options = ObjectUtils.merge({
      version: &apos;0.0.0&apos;,
      filesizeLimit: &apos;15MB&apos;,
      configuration: {
        default: null,
        name: &apos;app&apos;,
        path: &apos;config/&apos;,
        hasFolder: true,
        environmentVariable: &apos;CONFIG&apos;,
        loadFromEnvironment: true,
        loadVersionFromConfiguration: true,
        filenameFormat: &apos;[app-name].[configuration-name].config.js&apos;,
      },
      statics: {
        enabled: true,
        onHome: false,
        route: &apos;statics&apos;,
        folder: &apos;&apos;,
      },
      express: {
        trustProxy: true,
        disableXPoweredBy: true,
        compression: true,
        bodyParser: true,
        multer: true,
      },
      defaultServices: {
        common: true,
        http: true,
        utils: true,
      },
    }, options);
    /**
     * The Express app Jimpex uses under the hood.
     * @type {Express}
     * @access protected
     * @ignore
     */
    this._express = express();
    /**
     * When the app starts, this will be running instance.
     * @type {?Object}
     * @access protected
     * @ignore
     */
    this._instance = null;
    /**
     * A list of functions that return controllers and middlewares. When the app starts, the
     * queue will be processed and those controllers and middlewares added to the app.
     * The reason they are not added directly like with a regular Express implementation is that
     * services on Jimple use lazy loading, and adding middlewares and controllers as they come
     * could cause errors if they depend on services that are not yet registered.
     * @type {Array}
     * @access protected
     * @ignore
     */
    this._mountQueue = [];
    /**
     * A list of all the top routes controlled by the app. Every time a controller is mounted,
     * its route will be added here.
     * @type {Array}
     * @access protected
     * @ignore
     */
    this._controlledRoutes = [];

    this._setupCoreServices();
    this._setupExpress();
    this._setupDefaultServices();
    this._setupConfiguration();

    if (boot) {
      this.boot();
    }
  }
  /**
   * The app options.
   * @type {JimpexOptions}
   */
  get options() {
    return ObjectUtils.copy(this._options);
  }
  /**
   * The Express app Jimpex uses under the hood.
   * @type {Express}
   */
  get express() {
    return this._express;
  }
  /**
   * The server instance that gets created when the app is started.
   * @return {?Object}
   */
  get instance() {
    return this._instance;
  }
  /**
   * A list of all the top routes controlled by the app.
   * @type {Array}
   */
  get routes() {
    return ObjectUtils.copy(this._controlledRoutes);
  }
  /**
   * This is where the app would register all its specific services, middlewares and controllers.
   * @throws {Error} if not overwritten.
   * @abstract
   */
  boot() {
    throw new Error(&apos;This method must be overwritten&apos;);
  }
  /**
   * Tries to access a service on the container, but if is not present, it won&apos;t throw an error, it
   * will just return `null`.
   * @param {string} name The name of the service.
   * @return {*}
   */
  try(name) {
    let result;
    try {
      result = this.get(name);
    } catch (error) {
      /**
       * Validate if the received error is from Jimple not being able to find the service, or from
       * something else; if it&apos;s not about the module not being registered, throw the error.
       */
      const expression = new RegExp(escapeForRegExp(`identifier &quot;${name}&quot; is not defined`), &apos;i&apos;);
      if (error.message &amp;&amp; error.message.match(expression)) {
        result = null;
      } else {
        throw error;
      }
    }

    return result;
  }
  /**
   * Mounts a controller on a specific route.
   * @param {string}                       route      The route for the controller.
   * @param {Controller|ControllerCreator} controller The route controller.
   */
  mount(route, controller) {
    this._mountQueue.push((server) =&gt; {
      let result;
      const routes = this._reduceWithEvent(
        &apos;controllerWillBeMounted&apos;,
        controller.connect(this, route),
        route,
        controller
      );
      if (Array.isArray(routes)) {
        // If the returned value is a list of routes, mount each single route.
        result = routes.forEach((routeRouter) =&gt; server.use(route, routeRouter));
      } else {
        // But if the returned value is not a list, it may be a router, so mount it directly.
        result = server.use(route, routes);
      }

      this._controlledRoutes.push(route);
      this._emitEvent(&apos;routeAdded&apos;, route);
      return result;
    });
  }
  /**
   * Adds a middleware.
   * @param {Middleware|MiddlewareCreator|ExpressMiddleware} middleware The middleware to use.
   */
  use(middleware) {
    this._mountQueue.push((server) =&gt; {
      if (typeof middleware.connect === &apos;function&apos;) {
        // If the middleware is from Jimpex, connect it and then use it.
        const middlewareHandler = middleware.connect(this);
        if (middlewareHandler) {
          server.use(this._reduceWithEvent(
            &apos;middlewareWillBeUsed&apos;,
            middlewareHandler,
            middleware
          ));
        }
      } else {
        // But if the middleware is a regular middleware, just use it directly.
        server.use(this._reduceWithEvent(
          &apos;middlewareWillBeUsed&apos;,
          middleware,
          null
        ));
      }
    });
  }
  /**
   * Starts the app server.
   * @param {function(config:AppConfiguration)} [fn] A callback function to be called when the
   *                                                 server starts.
   * @return {Object} The server instance
   */
  start(fn = () =&gt; {}) {
    const config = this.get(&apos;appConfiguration&apos;);
    const port = config.get(&apos;port&apos;);
    this._emitEvent(&apos;beforeStart&apos;);
    this._instance = this._express.listen(port, () =&gt; {
      this._emitEvent(&apos;start&apos;);
      this._mountResources();
      this.get(&apos;appLogger&apos;).success(`Starting on port ${port}`);
      this._emitEvent(&apos;afterStart&apos;);
      const result = fn(config);
      this._emitEvent(&apos;afterStartCallback&apos;);
      return result;
    });

    return this._instance;
  }
  /**
   * This is an alias of `start`. The idea is for it to be used on serverless platforms, where you
   * don&apos;t get to start your app, you just have export it.
   * @param {number}                            port The port where the app will run. In case the
   *                                                 rest of the app needs to be aware of the port,
   *                                                 this method will overwrite the `port` setting
   *                                                 on the configuration.
   * @param {function(config:AppConfiguration)} [fn] A callback function to be called when the
   *                                                 server starts.
   * @return {Object} The server instance
   */
  listen(port, fn = () =&gt; {}) {
    const config = this.get(&apos;appConfiguration&apos;);
    config.set(&apos;port&apos;, port);
    return this.start(fn, port);
  }
  /**
   * Disables the server TLS validation.
   */
  disableTLSValidation() {
    // eslint-disable-next-line no-process-env
    process.env.NODE_TLS_REJECT_UNAUTHORIZED = &apos;0&apos;;
    this.get(&apos;appLogger&apos;).warning(&apos;TLS validation has been disabled&apos;);
  }
  /**
   * Stops the server instance.
   */
  stop() {
    if (this._instance) {
      this._emitEvent(&apos;beforeStop&apos;);
      this._instance.close();
      this._instance = null;
      this._emitEvent(&apos;afterStop&apos;);
    }
  }
  /**
   * Registers the _&apos;core services&apos;_.
   * @ignore
   * @access protected
   */
  _setupCoreServices() {
    // The logger service.
    this.register(appLogger);
    // The service that reads the environment variables.
    this.register(environmentUtils);
    // The app `package.json` information.
    this.register(packageInfo);
    // The service to build paths relative to the project root directory.
    this.register(pathUtils);
    // The service to make `require`s relatives to the project root directory.
    this.register(rootRequire);
  }
  /**
   * Creates and configure the Express instance.
   * @ignore
   * @access protected
   */
  _setupExpress() {
    const {
      statics,
      filesizeLimit,
      express: expressOptions,
    } = this._options;
    if (expressOptions.trustProxy) {
      this._express.enable(&apos;trust proxy&apos;);
    }

    if (expressOptions.disableXPoweredBy) {
      this._express.disable(&apos;x-powered-by&apos;);
    }

    if (expressOptions.compression) {
      this._express.use(compression());
    }

    if (statics.enabled) {
      this._addStaticsFolder(
        statics.route,
        statics.folder,
        statics.onHome
      );
    }

    if (expressOptions.bodyParser) {
      this._express.use(bodyParser.json({
        limit: filesizeLimit,
      }));
      this._express.use(bodyParser.urlencoded({
        extended: true,
        limit: filesizeLimit,
      }));
    }

    if (expressOptions.multer) {
      this._express.use(multer().any());
    }

    this.set(&apos;router&apos;, this.factory(() =&gt; express.Router()));
  }
  /**
   * Helper method to add static folders to the app.
   * @param {string}  route          The route for the static folder.
   * @param {string}  [folder=&apos;&apos;]    The path to the folder. If not defined, it will use the
   *                                 value from `route`.
   * @param {Boolean} [onHome=false] If `true`, the path to the folder will be relative to where
   *                                 the app is being executed (`process.cwd()`), otherwise, it
   *                                 will be relative to where the executable file is located.
   * @access protected
   * @ignore
   */
  _addStaticsFolder(route, folder = &apos;&apos;, onHome = false) {
    const joinFrom = onHome ? &apos;home&apos; : &apos;app&apos;;
    const staticRoute = route.replace(/^\/+/, &apos;&apos;);
    const staticFolder = this.get(&apos;pathUtils&apos;).joinFrom(
      joinFrom,
      folder || staticRoute
    );
    this._express.use(`/${staticRoute}`, express.static(staticFolder));
  }
  /**
   * Based on the constructor received options, register or not the default services.
   * @ignore
   * @access protected
   */
  _setupDefaultServices() {
    const { defaultServices } = this._options;

    if (defaultServices.common) {
      this.register(commonServices);
    }

    if (defaultServices.http) {
      this.register(httpServices);
    }

    if (defaultServices.utils) {
      this.register(utilsServices);
    }

    this.set(&apos;events&apos;, () =&gt; new EventsHub());
  }
  /**
   * Creates the configuration service.
   * @ignore
   * @access protected
   */
  _setupConfiguration() {
    const { version, configuration: options } = this._options;
    const {
      name,
      environmentVariable,
      loadVersionFromConfiguration,
    } = options;
    let configsPath = options.path;
    if (options.hasFolder) {
      configsPath += `${options.name}/`;
    }
    const filenameFormat = options.filenameFormat
    .replace(/\[app-name\]/ig, name)
    .replace(/\[configuration-name\]/ig, &apos;[name]&apos;);

    let defaultConfig = {};
    if (options.default) {
      defaultConfig = options.default;
    } else {
      const defaultConfigPath = `${configsPath}${options.name}.config.js`;
      defaultConfig = this.get(&apos;rootRequire&apos;)(defaultConfigPath);
    }

    if (!loadVersionFromConfiguration) {
      defaultConfig = Object.assign({ version }, defaultConfig);
    }

    this.register(appConfiguration(
      name,
      defaultConfig,
      {
        environmentVariable,
        path: configsPath,
        filenameFormat,
      }
    ));

    if (options.loadFromEnvironment) {
      this.get(&apos;appConfiguration&apos;).loadFromEnvironment();
    }

    if (loadVersionFromConfiguration) {
      this._options.version = this.get(&apos;appConfiguration&apos;).get(&apos;version&apos;);
    }
  }
  /**
   * Processes and mount all the resources on the `mountQueue`.
   * @ignore
   * @access protected
   */
  _mountResources() {
    this._mountQueue.forEach((mountFn) =&gt; mountFn(this._express));
    this._mountQueue.length = 0;
  }
  /**
   * Emits an app event with a reference to this class instance.
   * @param {string} name The name of the event on {@link JimpexEvents}.
   * @param {...*}   args   Extra parameters for the listeners.
   * @access protected
   */
  _emitEvent(name, ...args) {
    this.get(&apos;events&apos;).emit(eventNames[name], ...[...args, this]);
  }
  /**
   * Sends a target object to a list of reducer events so they can modify or replace it. This
   * method also sends a reference to this class instance as the last parameter of the event.
   * @param {string} name   The name of the event on {@link JimpexEvents}.
   * @param {*}      target The targe object to reduce.
   * @param {...*}   args   Extra parameters for the listeners.
   * @return {*} An object of the same type as the `target`.
   * @access protected
   */
  _reduceWithEvent(name, target, ...args) {
    return this.get(&apos;events&apos;).reduce(eventNames[name], target, ...[...args, this]);
  }
}

module.exports = Jimpex;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
