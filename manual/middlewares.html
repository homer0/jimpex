<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | jimpex</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Express as dependency injection container."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="jimpex"><meta property="twitter:description" content="Express as dependency injection container."></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/homer0/jimpex"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/options.html"><a href="manual/options.html" data-ice="link">Jimpex Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#configuration" data-ice="link">Configuration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#statics" data-ice="link">Statics</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#express" data-ice="link">Express</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#default-services" data-ice="link">Default services</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/controllers.html"><a href="manual/controllers.html" data-ice="link">Built-in Controllers</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#configuration" data-ice="link">Configuration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#health" data-ice="link">Health</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#statics" data-ice="link">Statics</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#gateway" data-ice="link">Gateway</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/middlewares.html"><a href="manual/middlewares.html" data-ice="link">Built-in Middlewares</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#error-handler" data-ice="link">Error Handler</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#force-https" data-ice="link">Force HTTPS</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#fast-html" data-ice="link">Fast HTML</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#show-html" data-ice="link">Show HTML</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#version-validator" data-ice="link">Version validator</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/services.html"><a href="manual/services.html" data-ice="link">Built-in Services</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#api-client" data-ice="link">API Client</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#app-error" data-ice="link">App Error</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#ensure-bearer-token" data-ice="link">Ensure bearer token</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#http-error" data-ice="link">HTTP Error</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#send-file" data-ice="link">Send File</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#frontend-fs" data-ice="link">Frontend Fs</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#html-generator" data-ice="link">HTML Generator</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#http" data-ice="link">HTTP</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#responses-builder" data-ice="link">Responses builder</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="built-in-middlewares">Built-in Middlewares</h1><p>All of these controllers are available on the Jimpex package and can be easily required and implemented.</p>
<h2 id="error-handler">Error Handler</h2><p>Allows you to generate responses for errors and potentially hide uncaught exceptions under a generic message, unless it&apos;s disabled via configuration settings.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>responsesBuilder</code> and <code>appError</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    http: { responsesBuilder },
    common: { appError },
  },
  middlewares: {
    common: { errorHandler },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(responsesBuilder);
    this.register(appError);

    ...

    // Add the middleware at the end.
    this.use(errorHandler);
  }
}</code>
</code></pre>
<p>Now, there&apos;s a configuration setting for this controller: <code>debug.showErrors</code>. By enabling the setting, the middleware will show the message and the stack information of all kind of errors.</p>
<p>If the configuration setting is disabled (or not present), the errors stack will never be visible, and if the error is not an instance of <code>AppError</code>, it will show a generic message.</p>
<p>By default, the generic message is <em>&quot;Oops! Something went wrong, please try again&quot;</em> and the default HTTP status is <code>500</code>, but you can use it as a function to modify those defaults:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    http: { responsesBuilder },
    common: { appError },
  },
  middlewares: {
    common: { errorHandler },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(responsesBuilder);
    this.register(appError);

    ...

    // Add the middleware at the end.
    this.use(errorHandler({
      default: {
        message: &apos;Unknown error&apos;,
        status: 503,
      },
    }));
  }
}</code>
</code></pre>
<p>Finally, when using errors of the type <code>AppError</code>, you can add the following context information:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">// Assuming `AppError` is the injected `AppError` and you are on the context of a middleware
next(new AppError(&apos;Something went wrong&apos;, {
  status: someHTTPStatus,
  response: someObject,
}));</code>
</code></pre>
<ul>
<li><code>status</code> will replace the error responses HTTP status.</li>
<li><code>response</code> will be merged into the error response <code>data</code> key.</li>
</ul>
<h2 id="force-https">Force HTTPS</h2><p>Redirect all incoming traffic from HTTP to HTTPS. It also allows you to set routes to ignore the redirection.</p>
<ul>
<li>Module: <code>common</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  middlewares: {
    common: { forceHTTPS },
  },
};

class App extends Jimpex {
  boot() {
    // Add the middleware first.
    this.use(errorHandler);
  }
}</code>
</code></pre>
<p>By default, it redirects all the URLs that don&apos;t start with <code>/service/</code> from HTTP to HTTPs, but you can use it as a function to modify the rules:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  middlewares: {
    common: { forceHTTPS },
  },
};

class App extends Jimpex {
  boot() {
    // Add the middleware first.
    this.use(forceHTTPS([
      /^\/service\//,
      /^\/api\//,
    ]));
  }
}</code>
</code></pre>
<p><strong>VERY IMPORTANT:</strong> The forced redirection will only happen if your configuration has a setting named <code>forceHTTPS</code> with a value of <code>true</code>.</p>
<h2 id="fast-html">Fast HTML</h2><p>Allows your app to skip unnecessary processing by showing an specific HTML when a requested route doesn&apos;t have a controller for it or is not on a &quot;whitelist&quot;</p>
<ul>
<li>Module: <code>html</code></li>
<li>Requires: <code>events</code>, <code>sendFile</code> and, optionally, an <code>HTMLGenerator</code> service.</li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  middlewares: {
    html: { fastHTML },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);

    // Add the middleware on one of the first positions.
    this.use(fastHTML);
  }
}</code>
</code></pre>
<p>The middleware has a few options with default values that can be customized:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{
  // The name of the file it will serve.
  file: &apos;index.html&apos;,
  // A list of expressions for routes that should be ignored.
  ignore: [/\.ico$/i],
  // Whether or not to use the routes controlled by the app to validate the requests.
  useAppRoutes: true,
  // The name of the HTML Generator service the middleware can use to obtain the HTML. 
  htmlGenerator: &apos;htmlGenerator&apos;,
}</code>
</code></pre>
<p>You can customize all those options by just calling the middleware as a function:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  middlewares: {
    html: { fastHTML },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);

    // Add the middleware on one of the first positions.
    this.use(fastHTML({
      file: &apos;my-custom-index.html&apos;,
      ignore: [`/^\/service\//`],
      useAppRoutes: false,
      htmlGenerator: null, // To disable it.
    }));
  }
}</code>
</code></pre>
<p>Now, as mentioned on the requirements, you can optionally use the <code>htmlGenerator</code> service or an <code>HTMLGenerator</code>-like service to serve a generated file.</p>
<p>You use the <code>htmlGenerator</code> option to disable it, or modify the name of the service it will look for:</p>
<ul>
<li>If you set it to a <em>&quot;falsy&quot;</em> value, it will be disabled.</li>
<li>If you change its name, it will try to look for that service when mounted.</li>
</ul>
<p><strong>Important:</strong> When using the generator, no matter the value you set on the <code>file</code> option, it will overwritten with the name of the file from the generator service.</p>
<h2 id="show-html">Show HTML</h2><p>A really simple middleware to serve an HTML file. Its true feature is that it can be hooked up to the <strong>HTML Generator</strong> service.</p>
<ul>
<li>Module: <code>html</code></li>
<li>Requires: <code>sendFile</code> and, optionally, an <code>HTMLGenerator</code> service.</li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  middlewares: {
    html: { showHTML },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);

    // Add the middleware at the end.
    this.use(showHTML);
  }
}</code>
</code></pre>
<p>By default, if the middleware is reached, it will show an <code>index.html</code>, but you can use it as a function to modify the filename:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  middlewares: {
    html: { showHTML },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);

    // Add the middleware at the end.
    this.use(showHTML({
      file: &apos;my-file.html&apos;,
    }));
  }
}</code>
</code></pre>
<p>Now, as mentioned on the requirements, you can optionally use the <code>htmlGenerator</code> or an <code>HTMLGenerator</code> service to show the generated file.</p>
<p>The default implementation checks if there&apos;s an <code>htmlGenerator</code> service registered on the app and uses that file; and in the case of <code>showHTML</code>, you can specify a second parameter with the name of the <code>HTMLGenerator</code> service name you want to use.</p>
<h2 id="version-validator">Version validator</h2><p>This can be used as a middleware and as controller. The idea is that it validates a <code>version</code> parameter against the version defined on the configuration.</p>
<ul>
<li>Module: <code>utils</code></li>
<li>Requires: <code>appConfiguration</code>, <code>responsesBuilder</code> and <code>appError</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  middlewares: {
    utils: { versionValidator },
  },
};

class App extends Jimpex {
  boot() {
    // Add the middleware before the routes you want to be protected.
    this.use(versionValidator);
    // or, protect a specific route.
    this.mount(&apos;/to-protect&apos;, versionValidator);
  }
}</code>
</code></pre>
<p>By default, it comes with a lot of already defined options, like whether or not to allow <code>latest</code> as a version, but you can use it as a function to modify them, for example:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  middlewares: {
    utils: { versionValidator },
  },
};

class App extends Jimpex {
  boot() {
    // Add the middleware before the routes you want to be protected.
    this.use(versionValidator({
      latest: {
        allow: false,
      }
    }));
    // or, protect a specific route.
    this.mount(&apos;/to-protect&apos;, versionValidator({
      latest: {
        allow: false,
      }
    }));
  }
}</code>
</code></pre>
<p><strong>Very important:</strong> The middleware will only validate if <code>req.params.version</code> is found.</p>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
