<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual | jimpex</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Express as dependency injection container."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="jimpex"><meta property="twitter:description" content="Express as dependency injection container."></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/homer0/jimpex"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/options.html"><a href="manual/options.html" data-ice="link">Jimpex Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#configuration" data-ice="link">Configuration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#statics" data-ice="link">Statics</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#express" data-ice="link">Express</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/options.html"><a href="manual/options.html#default-services" data-ice="link">Default services</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/controllers.html"><a href="manual/controllers.html" data-ice="link">Built-in Controllers</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#configuration" data-ice="link">Configuration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#health" data-ice="link">Health</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#statics" data-ice="link">Statics</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/controllers.html"><a href="manual/controllers.html#gateway" data-ice="link">Gateway</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/middlewares.html"><a href="manual/middlewares.html" data-ice="link">Built-in Middlewares</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#error-handler" data-ice="link">Error Handler</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#force-https" data-ice="link">Force HTTPS</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#fast-html" data-ice="link">Fast HTML</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#show-html" data-ice="link">Show HTML</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/middlewares.html"><a href="manual/middlewares.html#version-validator" data-ice="link">Version validator</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/services.html"><a href="manual/services.html" data-ice="link">Built-in Services</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#api-client" data-ice="link">API Client</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#app-error" data-ice="link">App Error</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#ensure-bearer-token" data-ice="link">Ensure bearer token</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#http-error" data-ice="link">HTTP Error</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#send-file" data-ice="link">Send File</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#frontend-fs" data-ice="link">Frontend Fs</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#html-generator" data-ice="link">HTML Generator</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#http" data-ice="link">HTTP</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/services.html"><a href="manual/services.html#responses-builder" data-ice="link">Responses builder</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="built-in-controllers">Built-in Controllers</h1><p>All of these controllers are available on the Jimpex package and can be easily required and implemented.</p>
<h2 id="configuration">Configuration</h2><p>Allows you to see and switch the current configuration. It can be enabled or disabled by using a setting on the configuration.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>responsesBuilder</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    http: { responsesBuilder },
  },
  controllers: {
    common: { configurationController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(responsesBuilder);

    // Add the controller.
    this.mount(&apos;/config&apos;, configurationController);
  }
}</code>
</code></pre>
<p>Now, there are two rules behind this controller:</p>
<ol>
<li>Your configuration must have a setting <code>debug.configurationController</code> with the value of <code>true</code>.</li>
<li>To be able to switch configurations, the default configuration and/or the first configuration loaded must have a setting <code>allowConfigurationSwitch</code> set to <code>true</code>.</li>
</ol>
<p>The reason for those rules is that this controller is development purposes as you wouldn&apos;t want to make public the settings of your app.</p>
<p>The controller then will mount two routes:</p>
<ul>
<li><code>GET /</code>: It will show the current configuration.</li>
<li><code>GET /switch/:name</code>: It will, if allowed, switch to an specified configuration.</li>
</ul>
<h2 id="health">Health</h2><p>Shows the version and name of the configuration, just to check the app is running.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>responsesBuilder</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    http: { responsesBuilder },
  },
  controllers: {
    common: { healthController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(responsesBuilder);

    // Add the controller.
    this.mount(&apos;/health&apos;, healthController);
  }
}</code>
</code></pre>
<p>That&apos;s all there is, the controller mounts only one route:</p>
<ul>
<li><code>GET /</code>: Shows the information.</li>
</ul>
<h2 id="statics">Statics</h2><p>It allows your app to server specific files from any directory, without having to use the <code>static</code> middleware.</p>
<ul>
<li>Module: <code>common</code></li>
<li>Requires: <code>sendFile</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  controllers: {
    common: { staticsController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);

    // Add the controller.
    this.mount(&apos;/&apos;, staticsController);
  }
}</code>
</code></pre>
<p>The controller comes with a lot of default options:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{
  // The list of files it will serve.
  files: [&apos;favicon.ico&apos;, &apos;index.html&apos;],
  // The HTTP methods for which it will mount routes.
  methods: {
    // If `all` is `true`, then all the others are ignored.
    all: false,
    get: true,
  },
  // The &quot;master&quot; paths to prepend to all file routes and files.
  paths: {
    // The base route from where the files are going to be served.
    route: &apos;&apos;,
    // The base path from where the files are located.
    source: &apos;./&apos;,
  },
}</code>
</code></pre>
<p>All of those values can be customized by calling the controller as a function:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    common: { sendFile },
  },
  controllers: {
    common: { staticsController },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(sendFile);

    // Add the controller.
    this.mount(&apos;/&apos;, staticsController({
      paths: {
        route: &apos;public&apos;,
        source: &apos;secret-folder&apos;,
      }
      files: [
        &apos;my-file-one.html&apos;,
        &apos;favicon.icon&apos;,
        &apos;index.html&apos;,
        &apos;some-other.html&apos;,
      ],
    }));
  }
}</code>
</code></pre>
<p>You can also specify custom information to each individual file:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">this.mount(&apos;/&apos;, staticsController({
  files: [
    &apos;my-file-one.html&apos;,
    {
      route: &apos;favicon.ico&apos;,
      source: &apos;icons/fav/icon.ico&apos;,
      headers: {
        &apos;X-Custom-Icon-Header&apos;: &apos;Something!&apos;,
      },
    },
    &apos;index.html&apos;,
  ],
}));</code>
</code></pre>
<p>Finally, you can also add a custom middleware or middlewares to the routes created by the controller, you just need to send a function that returns the middlewares when called.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">/**
 * In this case, we&apos;ll use Jimpex&apos;s `ensureBearerToken` to protect the
 * file routes.
 */
const filesProtection = (app) =&gt; [app.get(&apos;ensureBearerToken&apos;)];

this.mount(&apos;/&apos;, staticsController(
  {
    files: [
      &apos;index.html&apos;,
    ],
  },
  [filesProtection]
));</code>
</code></pre>
<p>And that&apos;s all, the middleware will be added to the route, just before serving the file.</p>
<h2 id="gateway">Gateway</h2><p>It allows you to automatically generate a set of routes that will make gateway requests to an specific API.</p>
<ul>
<li>Module: <code>utils</code></li>
<li>Requires: <code>http</code></li>
</ul>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    http: { http },
  },
  controllers: {
    utils: { gateway },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(http);

    // Add the controller.
    this.mount(&apos;/gateway&apos;, gateway);
  }
}</code>
</code></pre>
<p>The controller will automatically look into your app configuration for a key called <code>api</code> with the following format:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{
  url: &apos;api-entry-point&apos;,
  gateway: {
    endpointOne: &apos;endpoint/one/path&apos;,
  },
}</code>
</code></pre>
<blockquote>
<p>Yes, the format is almost the same as the API Client.</p>
</blockquote>
<p>Based on the example above and that configuration, the controller would mount a route on <code>/gateway/endpoint/one/path</code> that would fire a request to <code>api-entry-point/endpoint/one/path</code>.</p>
<p>The controller has a few options that you can customize:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">{

  // The name that will be used to register the controller as a sevice (yes!),
  // so other services can access the API Client configuration the controller
  // generates from its routes.

  serviceName: &apos;apiGateway&apos;,

  // The name of a registered service that will work as a helper, and that the
  // controller will call in order to modify requests, responses and even handle
  // errors.
  helperServiceName: &apos;apiGatewayHelper&apos;,

  // The name of the configuration setting where the gateway configuration is stored.
  // This is also used to wrap the endpoints on the generated API Client configuration.
  configurationSetting: &apos;api&apos;,

  // This is a helper for when the gateway is used with an API client. The idea is
  // that, by default, the routes are mounted on the controller route, but with
  // this option, you can specify another sub path. For example: The controller
  // is mounted on `/routes`, if you set `root` to `gateway`, all the routes will
  // be on `/routes/gateway`.
  root: &apos;&apos;,

  // How the gateway will handle headers from requests and responses.
  headers: {

    // Whether or not to include the header with a request real IP.
    useXForwardedFor: true,

    // Whether or not to copy the custom headers (the ones that start with `x-`).
    copyCustomHeaders: true,

    // A list of headers that will be copied from the incoming request into the
    // fetch request.
    copy: [
      &apos;authorization&apos;,
      &apos;content-type&apos;,
      &apos;referer&apos;,
      &apos;user-agent&apos;,
    ],

    // A list of headers that will be removed while copying the headers from a
    // fetch response into the server&apos;s response.
    remove: [
      &apos;server&apos;,
      &apos;x-powered-by&apos;,
    ],
  },
}</code>
</code></pre>
<p>The way you overwrite them is by calling the controller as a function:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const {
  Jimpex,
  services: {
    http: { http },
  },
  controllers: {
    utils: { gateway },
  },
};

class App extends Jimpex {
  boot() {
    // Register the dependencies...
    this.register(http);

    // Add the controller.
    this.mount(&apos;/gateway&apos;, gateway({
      serviceName: &apos;Batman&apos;,
    }));
  }
}</code>
</code></pre>
<p>I strongly recommend you to read the techinical documentation in order to know all the things you
can do with the helper service and the logic behind the naming convetion the controller creator enforces (the <code>serviceName</code> must end with <code>Gateway</code>, among other things).</p>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
