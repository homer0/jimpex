<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8" />
    <title>middlewares/common/hsts.js - jimpex docs</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />
    <link rel="shortcut icon" href="icons/favicon-48.png" />
    <link rel="apple-touch-icon" sizes="48x48" href="icons/favicon-48.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="icons/favicon-72.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="icons/favicon-96.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="icons/favicon-144.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icons/favicon-192.png" />
    <link rel="apple-touch-icon" sizes="256x256" href="icons/favicon-256.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="icons/favicon-384.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="icons/favicon-512.png" />
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html" class="home-link">jimpex</a></h2><ul class="ref-links">
            <li><a
                class="ref-link -yarn"
                title="View the package on Yarn"
                href="https://yarnpkg.com/package/jimpex"
                target="_blank"
            >View the package on Yarn</a></li>
        

            <li><a
                class="ref-link -github"
                title="Go to the GitHub repository"
                href="https://github.com/homer0/jimpex"
                target="_blank"
            >Go to the GitHub repository</a></li>
        

            <li><a
                class="ref-link -npm"
                title="View the package on NPM"
                href="https://www.npmjs.com/package/jimpex"
                target="_blank"
            >View the package on NPM</a></li>
        </ul><h3>Modules</h3><ul><li><a href="module-constants.html">constants</a></li><li><a href="module-controllers.html">controllers</a></li><li><a href="module-core.html">core</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core.html#~jimpex">jimpex</a></li></ul></li><li><a href="module-functions.html">functions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-functions.html#.createRouteExpression">createRouteExpression</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.escapeForRegExp">escapeForRegExp</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeLeadingSlash">removeLeadingSlash</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeSlashes">removeSlashes</a></li><li data-type='method' style='display: none;'><a href="module-functions.html#.removeTrailingSlash">removeTrailingSlash</a></li></ul></li><li><a href="module-middlewares.html">middlewares</a></li><li><a href="module-services.html">services</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-services.html#.appErrorGenerator">appErrorGenerator</a></li><li data-type='method' style='display: none;'><a href="module-services.html#.httpErrorGenerator">httpErrorGenerator</a></li><li data-type='method' style='display: none;'><a href="module-services.html#.sendFile">sendFile</a></li></ul></li><li><a href="module-wrappers.html">wrappers</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-wrappers.html#.controller">controller</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.controllerCreator">controllerCreator</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.middleware">middleware</a></li><li data-type='method' style='display: none;'><a href="module-wrappers.html#.middlewareCreator">middlewareCreator</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-controllers.html">controllers</a></li><li><a href="tutorial-middlewares.html">middlewares</a></li><li><a href="tutorial-options.html">options</a></li><li><a href="tutorial-services.html">services</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">middlewares/common/hsts.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { middlewareCreator } = require('../../utils/wrappers');

/**
 * @typedef {import('../../types').ExpressMiddleware} ExpressMiddleware
 */

/**
 * @typedef {import('../../types').MiddlewareCreator&lt;O>} MiddlewareCreator&lt;O>
 * @template O
 */

/**
 * The options to customize the HSTS header value.
 *
 * @typedef {Object} HSTSOptions
 * @property {number}  [maxAge=31536000]         The time, in seconds, that the browser
 *                                               should remember that a site is only to be
 *                                               accessed using HTTPS.
 * @property {boolean} [includeSubDomains=true]  Whether or not the rule should apply to
 *                                               all sub domains.
 * @property {boolean} [preload=false]           Whether or not to include on the major
 *                                               browsers'
 *                                               preload list. This directive is not part
 *                                               of the specification, for more
 *                                               information about it, you should check
 *                                               the MDN documentation for the header.
 * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security
 * @parent module:middlewares
 */

/**
 * It configures a `Strict-Transport-Security` header and includes it on every response.
 *
 * @see https://tools.ietf.org/html/rfc6797
 * @parent module:middlewares
 */
class HSTS {
  /**
   * @param {Partial&lt;HSTSOptions>} [options={}]  The options to customize the header
   *                                             value.
   */
  constructor(options = {}) {
    /**
     * The value of the header that will be included on every response.
     *
     * @type {string}
     * @access protected
     * @ignore
     */
    this._header = this._buildHeader({
      maxAge: 31536000,
      includeSubDomains: true,
      preload: false,
      ...options,
    });
  }
  /**
   * Returns the Express middleware that includes the header on the response.
   *
   * @returns {ExpressMiddleware}
   */
  middleware() {
    return (req, res, next) => {
      res.setHeader('Strict-Transport-Security', this._header);
      next();
    };
  }
  /**
   * The value of the header that will be included on every response.
   *
   * @type {string}
   */
  get header() {
    return this._header;
  }
  /**
   * Creates the value for the header.
   *
   * @param {HSTSOptions} options  The options to customize the header value.
   * @returns {string}
   * @access protected
   * @ignore
   */
  _buildHeader(options) {
    const directives = [`max-age=${options.maxAge}`];
    if (options.includeSubDomains) {
      directives.push('includeSubDomains');
    }

    if (options.preload) {
      directives.push('preload');
    }

    return directives.join('; ');
  }
}
/**
 * A middleware that creates and includes a `Strict-Transport-Security` header on every
 * response.
 * If the `options` parameter doesn't include the value for `maxAge`, the middleware will
 * ask the {@link AppConfiguration} service for the `hsts` settings as a fallback. You can
 * take advantage of that fallback to use the middleware and manage its settings from your
 * project configuration.
 * Both the `options` parameter and the `hsts` can include a `enabled` (boolean) flag to
 * either disable or enable the middleware.
 *
 * @type {MiddlewareCreator&lt;HSTSOptions>}
 * @parent module:middlewares
 */
const hsts = middlewareCreator((options = {}) => (app) => {
  const useOptions =
    typeof options.maxAge !== 'undefined'
      ? options
      : app.get('appConfiguration').get('hsts') || {};

  return typeof useOptions.enabled === 'undefined' || useOptions.enabled
    ? new HSTS(useOptions).middleware()
    : null;
});

module.exports.HSTS = HSTS;
module.exports.hsts = hsts;
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> using a forked <a href="https://github.com/homer0/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
